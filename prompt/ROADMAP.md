# LiuProxy v2.0 - Unified Development Roadmap

**最后更新**: 2025-09-28

本文档是 `LiuProxy v2.0` 项目的“活文档”，它既是未来的开发计划，也是对已完成工作的进度跟踪。它详细记录了每个阶段的核心任务、关键决策和重要产出。

---
## **总览**

*   **阶段一: 基础奠定 (已完成)**
*   **阶段二: Go 原生网关实现与架构统一 (已完成)**
*   **阶段三: 产品化与生态系统完善 (已完成)**
*   **阶段四: 全面在线化配置与高级功能 (已完成)**
*   **阶段五: 底层网络与透明代理 (进行中)** - 当前阶段，旨在将项目从应用层代理演进为真正的网络网关。

---
## **详细路线图**

### **阶段一 ~ 阶段三 (Completed)**
*   所有迭代均已完成。

---

### **阶段四：全面在线化配置与高级功能 (Completed)**

#### **迭代 4.1: 统一配置架构与网关参数在线化**
*   **状态**: ✅ **已完成**

#### **迭代 4.2: 路由规则管理 UI 与优先级系统重构**
*   **状态**: ✅ **已完成**

#### **迭代 4.3: 负载均衡策略在线化与UI架构重构**
*   **状态**: ✅ **已完成 (2025-09-28)**
*   **核心任务**:
    *   `[Backend]` ✅ **实现负载均衡策略模式**: 在 `Dispatcher` 中引入 `LoadBalancer` 接口，并实现了 "Least Connections" 和 "Round Robin" 两种策略。
    *   `[System]` ✅ **合并配置**: 将负载均衡策略配置整合进 `settings.json` 的 `gateway` 模块中。
    *   `[Backend]` ✅ **实现负载均衡热重载**: `Dispatcher` 现在可以根据 `gateway` 配置的变更，动态切换负载均衡策略。
    *   `[Web UI]` ✅ **UI架构重构**: 将 "Settings" 页面拆分为独立的 "Gateway" 和 "Routing" 页面，优化了用户体验和可扩展性。
*   **关键决策**: **采纳了将UI页面按功能模块拆分的建议**，并**将负载均衡策略视为网关的核心属性**，使配置逻辑更内聚。

#### **迭代 4.4: 移动端体验增强**
*   **状态**: 📝 **计划中**
*   **核心任务**:
    *   `[Android]` **(APP-05)**: 在 UI 和通知栏显示延迟和实时速度。
    *   `[Android]` **(APP-06)**: 支持通过 URL 订阅添加和更新服务器列表。

---

### **阶段五：底层网络与透明代理 (Current)**

本阶段的核心目标是实现一个功能完备的传统网络网关，支持防火墙和透明代理。

#### **迭代 5.1: 核心架构重构与技术验证 (IOC & PoC)**
*   **状态**: 🔄 **进行中**
*   **核心任务**:
    *   `[Backend]` (待办) **策略实例接口化 (IOC)**: 重构所有 `Strategy` 实例，使其不再监听本地端口，而是实现一个 `HandleConnection(net.Conn)` 接口，为直接接收连接做准备。
    *   `[Backend]` (待办) **Dispatcher 返回实例引用**: 修改 `Dispatcher`，使其在决策后返回策略实例的对象引用，而不是地址字符串，彻底移除内部TCP端口通信。
    *   `[System]` (待办) **透明代理技术验证 (PoC)**: 在独立的测试程序中，验证在Linux环境下使用 `iptables` + `getsockopt(SO_ORIGINAL_DST)` 成功拦截TCP连接并获取其原始目标地址。
*   **验收标准**: 现有标准代理功能在无 `localPort` 的新架构下完全正常工作；PoC程序能正确捕获并识别透明流量。

#### **迭代 5.2: 透明网关与防火墙实现**
*   **状态**: 📝 **计划中**
*   **核心任务**:
    *   `[Backend]` (待办) **实现 `TransparentGateway`**: 创建新的流量入口模块，负责处理被 `iptables` 重定向的流量。
    *   `[System]` (待办) **设计并实现防火墙规则**: 在 `settings.json` 中增加 `firewall` 模块，并实现防火墙规则匹配引擎，作为流量处理的第一道关卡。
    *   `[Web UI]` (待办) 在UI中为 `firewall` 模块创建管理界面。

#### **迭代 5.3: 流量监控、容器化与文档**
*   **状态**: 📝 **计划中**
*   **核心任务**:
    *   `[Backend]` (待办) **实现流量监控API**: 提供一个WebSocket端点，用于实时推送连接日志。
    *   `[Web UI]` (待办) **创建 "Monitor" 页面**: 用于实时展示网络活动。
    *   `[DevOps]` (待办) **创建 `Dockerfile` 与启动脚本**: 将应用打包为支持 `NET_ADMIN` 的Docker镜像，并编写 `iptables` 初始化脚本。
    *   `[Docs]` (待办) **撰写网关模式部署文档**，详细说明在Linux Docker环境下的部署和使用方法，并明确指出在Windows下的局限性。